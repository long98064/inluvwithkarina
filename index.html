<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aespa Premium Gallery</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>✨ AESPA UPDATES</h1>

    <div class="tabs-container" id="tabs"></div>

    <div class="section-title">Latest Instagram Posts</div>
    <div id="instagram-top-feed" class="insta-grid"></div>

    <hr class="divider">

    <div class="section-title">Pinterest Collection</div>
    <div id="pinterest-gallery" class="pin-grid"></div>

    <script>
        let globalData = null;

        async function init() {
            try {
                const response = await fetch('data.json');
                globalData = await response.json();
                renderTabs();
                if (globalData.profiles.length > 0) {
                    showFeed(globalData.profiles[0].username);
                }
            } catch (err) { console.error("Lỗi tải dữ liệu:", err); }
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('tabs');
            globalData.profiles.forEach((idol, index) => {
                const btn = document.createElement('button');
                btn.className = `tab-button ${index === 0 ? 'active' : ''}`;
                btn.innerText = idol.name;
                btn.onclick = () => {
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    showFeed(idol.username);
                };
                tabsContainer.appendChild(btn);
            });
        }

        function showFeed(username) {
            const instaFeed = document.getElementById('instagram-top-feed');
            const pinGallery = document.getElementById('pinterest-gallery');
            
            // Xóa nội dung cũ
            instaFeed.innerHTML = '';
            pinGallery.innerHTML = '';

            const idol = globalData.profiles.find(p => p.username === username);
            if (!idol) return;

            // Phân loại bài đăng
            const instaPosts = idol.posts.filter(p => p.type !== 'pinterest').slice(0, 3);
            const pinPosts = idol.posts.filter(p => p.type === 'pinterest');

            // Hiển thị Instagram (3 bài ngang)
            instaPosts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'insta-item';
                div.innerHTML = `<blockquote class="instagram-media" data-instgrm-permalink="${post.url}" data-instgrm-version="14"></blockquote>`;
                instaFeed.appendChild(div);
            });

            // Hiển thị Pinterest (Dạng lưới)
            pinPosts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'pin-item';
                div.innerHTML = `<img src="${post.url}" alt="Pinterest Photo" loading="lazy">`;
                pinGallery.appendChild(div);
            });

            // Kích hoạt lại Instagram Script
            if (window.instgrm) {
                window.instgrm.Embeds.process();
            } else {
                const script = document.createElement('script');
                script.async = true;
                script.src = "//www.instagram.com/embed.js";
                document.body.appendChild(script);
            }
        }
        init();
    </script>
</body>
</html>
